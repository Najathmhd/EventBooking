@model IEnumerable<EventBooking.Models.Booking>

@{
    ViewData["Title"] = User.IsInRole("Admin") ? "Global Metropolitan Reservations" : "My Cultural Wallet";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="container py-5" style="margin-top: 100px;">
    <!-- ... Header content ... -->
    <!-- (Assuming previous content is correct) -->
    
    @if (!Model.Any())
    {
        <!-- Empty State -->
    }
    else
    {
        <div class="row g-4 animate-slide-up" style="animation-delay: 0.2s">
            @foreach (var item in Model)
            {
                <div class="col-md-6 col-lg-4 reveal">
                    <div class="card h-100 shadow-sm border-0 overflow-hidden reservation-card hover-tilt">
                        <div class="card-body p-4">
                            <!-- Card Header & Dates -->
                            
                            <!-- Details Block -->
                            
                            <div class="d-grid gap-2">
                                <a asp-controller="Booking" asp-action="Ticket" asp-route-id="@item.BookingId" class="btn btn-primary rounded-pill shadow-sm">
                                    View Digital Pass <i class="fas fa-qrcode ms-2"></i>
                                </a>
                                
                                @if (item.Event?.EventDate < DateTime.Now && item.IsVerified)
                                {
                                    <!-- Review Modal Trigger -->
                                }

                                @if (User.IsInRole("Admin") && !item.IsVerified)
                                {
                                    <form asp-action="VerifyBooking" method="post" class="d-grid mb-2">
                                        <input type="hidden" name="id" value="@item.BookingId" />
                                        <button type="submit" class="btn btn-outline-success rounded-pill shadow-sm">
                                            Verify Pass <i class="fas fa-check-circle ms-2"></i>
                                        </button>
                                    </form>
                                }
                                else if (User.IsInRole("Admin"))
                                {
                                     <button class="btn btn-soft-success rounded-pill shadow-sm disabled mb-2 w-100" disabled>
                                        <i class="fas fa-check-double me-2"></i>Verified
                                    </button>
                                }

                                @if (item.Event?.EventDate > DateTime.Now)
                                {
                                    <form asp-controller="Booking" asp-action="Cancel" method="post" class="d-grid" onsubmit="return confirm('Are you sure you want to cancel this reservation? Seats will be released.');">
                                        <input type="hidden" name="id" value="@item.BookingId" />
                                        <button type="submit" class="btn btn-outline-danger rounded-pill shadow-sm">
                                            Cancel Reservation <i class="fas fa-times-circle ms-2"></i>
                                        </button>
                                    </form>
                                }
                            </div>
                        </div>
                    </div>
                </div>
            }
        </div>
    }
</div>
